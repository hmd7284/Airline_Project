-- Update seat
CREATE OR REPLACE FUNCTION update_remaining_seat_func() RETURNS TRIGGER AS
$$
DECLARE remaining_seat INTEGER;
BEGIN
    remaining_seat := (SELECT capacity FROM aircraft WHERE aircraft_code = NEW.aircraft);
    UPDATE flight_schedule SET business_seat = 20, economy_seat = remaining_seat - 20
    WHERE flight_code = NEW.flight_code;
    RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE TRIGGER update_remaining_seat
AFTER INSERT ON flight_schedule
FOR EACH ROW
EXECUTE PROCEDURE update_remaining_seat_func();
-- Check insert inactive aircraft
CREATE OR REPLACE FUNCTION check_insert_ac_func() RETURNS TRIGGER AS
$$
BEGIN
    IF ((SELECT status FROM aircraft WHERE aircraft_code = NEW.aircraft) = 'Inactive' ) 
    THEN RETURN NULL; ELSE RETURN NEW;
    END IF;
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE TRIGGER check_insert_ac
BEFORE INSERT ON flight_schedule
FOR EACH ROW
EXECUTE PROCEDURE check_insert_ac_func();

--Cause trigger cannot insert inactive aircraft so need to update
UPDATE aircraft SET status = 'Active';

-- Insert 60 records into flight_schedule
INSERT INTO flight_schedule(flight_code, departure_date, departure_time, arrival_date, arrival_time, aircraft, route) VALUES
('FL001', '2024-01-01', '08:00:00', '2024-01-01', '10:30:00', 'AC001', 'SGNHAN'),
('FL002', '2024-01-02', '12:45:00', '2024-01-02', '15:15:00', 'AC002', 'HANSGN'),
('FL003', '2024-01-03', '18:30:00', '2024-01-03', '21:00:00', 'AC003', 'HANDAD'),
('FL004', '2024-01-04', '09:15:00', '2024-01-04', '11:45:00', 'AC004', 'DADHAN'),
('FL005', '2024-01-05', '14:00:00', '2024-01-05', '16:30:00', 'AC005', 'SGNDAD'),
('FL006', '2024-01-06', '20:45:00', '2024-01-06', '23:15:00', 'AC006', 'DADSGN'),
('FL007', '2024-01-07', '07:30:00', '2024-01-07', '10:00:00', 'AC007', 'HANSWF'),
('FL008', '2024-01-08', '13:15:00', '2024-01-08', '15:45:00', 'AC008', 'SWFHAN'),
('FL009', '2024-01-09', '19:00:00', '2024-01-09', '21:30:00', 'AC009', 'HANHND'),
('FL010', '2024-01-10', '10:45:00', '2024-01-10', '13:15:00', 'AC010', 'HNDHAN'),
('FL011', '2024-01-11', '16:30:00', '2024-01-11', '19:00:00', 'AC011', 'HANBGH'),
('FL012', '2024-01-12', '05:15:00', '2024-01-12', '07:45:00', 'AC012', 'BGHHAN'),
('FL013', '2024-01-13', '11:00:00', '2024-01-13', '13:30:00', 'AC013', 'HANNAY'),
('FL014', '2024-01-14', '16:45:00', '2024-01-14', '19:15:00', 'AC014', 'NAYHAN'),
('FL015', '2024-01-15', '22:30:00', '2024-01-15', '01:00:00', 'AC015', 'HANPHT'),
('FL016', '2024-01-16', '09:15:00', '2024-01-16', '11:45:00', 'AC016', 'PHTHAN'),
('FL017', '2024-01-17', '15:00:00', '2024-01-17', '17:30:00', 'AC017', 'HANBML'),
('FL018', '2024-01-18', '20:45:00', '2024-01-18', '23:15:00', 'AC018', 'BMLHAN'),
('FL019', '2024-01-19', '06:30:00', '2024-01-19', '09:00:00', 'AC019', 'HANYQY'),
('FL020', '2024-01-20', '12:15:00', '2024-01-20', '14:45:00', 'AC020', 'YQYHAN'),
('FL021', '2024-01-21', '18:00:00', '2024-01-21', '20:30:00', 'AC021', 'HANYHM'),
('FL022', '2024-01-22', '07:45:00', '2024-01-22', '10:15:00', 'AC022', 'YHMHAN'),
('FL023', '2024-01-23', '13:30:00', '2024-01-23', '16:00:00', 'AC023', 'HANDMK'),
('FL024', '2024-01-24', '19:15:00', '2024-01-24', '21:45:00', 'AC024', 'DMKHAN'),
('FL025', '2024-01-25', '08:00:00', '2024-01-25', '10:30:00', 'AC025', 'HANSAW'),
('FL026', '2024-01-26', '13:45:00', '2024-01-26', '16:15:00', 'AC026', 'SAWHAN'),
('FL027', '2024-01-27', '19:30:00', '2024-01-27', '22:00:00', 'AC027', 'HANHLA'),
('FL028', '2024-01-28', '05:15:00', '2024-01-28', '07:45:00', 'AC028', 'HLAHAN'),
('FL029', '2024-01-29', '11:00:00', '2024-01-29', '13:30:00', 'AC029', 'HANTGA'),
('FL030', '2024-01-30', '16:45:00', '2024-01-30', '19:15:00', 'AC030', 'TGAHAN'),
('FL031', '2024-01-31', '22:30:00', '2024-01-31', '01:00:00', 'AC031', 'HANPSK'),
('FL032', '2024-02-01', '09:15:00', '2024-02-01', '11:45:00', 'AC032', 'PSKHAN'),
('FL033', '2024-02-02', '15:00:00', '2024-02-02', '17:30:00', 'AC033', 'HANAZP'),
('FL034', '2024-02-03', '20:45:00', '2024-02-03', '23:15:00', 'AC034', 'AZPHAN'),
('FL035', '2024-02-04', '06:30:00', '2024-02-04', '09:00:00', 'AC035', 'HANDEL'),
('FL036', '2024-02-05', '12:15:00', '2024-02-05', '14:45:00', 'AC036', 'DELHAN'),
('FL037', '2024-02-06', '18:00:00', '2024-02-06', '20:30:00', 'AC037', 'HANZRH'),
('FL038', '2024-02-07', '07:45:00', '2024-02-07', '10:15:00', 'AC038', 'ZRHHAN'),
('FL039', '2024-02-08', '13:30:00', '2024-02-08', '16:00:00', 'AC039', 'HANICN'),
('FL040', '2024-02-09', '19:15:00', '2024-02-09', '21:45:00', 'AC040', 'ICNHAN'),
('FL041', '2024-02-10', '08:00:00', '2024-02-10', '10:30:00', 'AC041', 'HANHKG'),
('FL042', '2024-02-11', '13:45:00', '2024-02-11', '16:15:00', 'AC042', 'HANWHP'),
('FL043', '2024-02-12', '19:30:00', '2024-02-12', '22:00:00', 'AC043', 'WHPHAN'),
('FL044', '2024-02-13', '05:15:00', '2024-02-13', '07:45:00', 'AC044', 'HANKIX'),
('FL045', '2024-02-14', '11:00:00', '2024-02-14', '13:30:00', 'AC045', 'KIXHAN'),
('FL046', '2024-02-15', '16:45:00', '2024-02-15', '19:15:00', 'AC046', 'HANMHT'),
('FL047', '2024-02-16', '22:30:00', '2024-02-16', '01:00:00', 'AC047', 'MHTHAN'),
('FL048', '2024-02-17', '09:15:00', '2024-02-17', '11:45:00', 'AC048', 'HANPVG'),
('FL049', '2024-02-18', '15:00:00', '2024-02-18', '17:30:00', 'AC049', 'PVGHAN'),
('FL050', '2024-02-19', '20:45:00', '2024-02-19', '23:15:00', 'AC050', 'HANCDG'),
('FL051', '2024-02-20', '06:30:00', '2024-02-20', '09:00:00', 'AC051', 'CDGHAN'),
('FL052', '2024-02-21', '12:15:00', '2024-02-21', '14:45:00', 'AC052', 'HANAGB'),
('FL053', '2024-02-22', '18:00:00', '2024-02-22', '20:30:00', 'AC053', 'AGBHAN'),
('FL054', '2024-02-23', '07:45:00', '2024-02-23', '10:15:00', 'AC054', 'HANMLB'),
('FL055', '2024-02-24', '13:30:00', '2024-02-24', '16:00:00', 'AC055', 'MLBHAN'),
('FL056', '2024-02-25', '19:15:00', '2024-02-25', '21:45:00', 'AC056', 'HANCXH'),
('FL057', '2024-02-26', '05:00:00', '2024-02-26', '07:30:00', 'AC057', 'CXHHAN'),
('FL058', '2024-02-27', '10:45:00', '2024-02-27', '13:15:00', 'AC058', 'HANBNE'),
('FL059', '2024-02-28', '16:30:00', '2024-02-28', '19:00:00', 'AC059', 'BNEHAN'),
('FL060', '2024-03-01', '22:15:00', '2024-03-01', '00:45:00', 'AC060', 'HANDEL');
