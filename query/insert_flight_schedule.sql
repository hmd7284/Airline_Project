-- Update seat
CREATE OR REPLACE FUNCTION update_remaining_seat_func ()
    RETURNS TRIGGER
    AS $$
DECLARE
    remaining_seat integer;
BEGIN
    remaining_seat := (
        SELECT
            capacity
        FROM
            aircraft
        WHERE
            aircraft_code = NEW.aircraft);
    UPDATE
        flight_schedule
    SET
        business_seat = (remaining_seat * 30 / 100),
        economy_seat = remaining_seat - (remaining_seat * 30 / 100)
    WHERE
        flight_code = NEW.flight_code;
    RETURN NULL;
END;
$$
LANGUAGE plpgsql;

CREATE OR REPLACE TRIGGER update_remaining_seat
    AFTER INSERT ON flight_schedule
    FOR EACH ROW
    EXECUTE PROCEDURE update_remaining_seat_func ();

-- Check insert inactive aircraft
CREATE OR REPLACE FUNCTION check_insert_update_ac_func ()
    RETURNS TRIGGER
    AS $$
BEGIN
    IF ((
        SELECT
            status
        FROM
            aircraft
        WHERE
            aircraft_code = NEW.aircraft) = 'Inactive') THEN
        RETURN NULL;
    ELSE
        RETURN NEW;
    END IF;
END;
$$
LANGUAGE plpgsql;

CREATE OR REPLACE TRIGGER check_insert_ac
    BEFORE INSERT ON flight_schedule
    FOR EACH ROW
    EXECUTE PROCEDURE check_insert_update_ac_func ();

CREATE OR REPLACE TRIGGER check_update_ac
    BEFORE UPDATE ON flight_schedule
    FOR EACH ROW
    WHEN (OLD.aircraft IS DISTINCT FROM NEW.aircraft)
    EXECUTE PROCEDURE check_insert_update_ac_func ();

-- Insert 60 records into flight_schedule
INSERT INTO flight_schedule (flight_code, departure_date, departure_time, arrival_date, arrival_time, aircraft, route)
    VALUES ('FL0001', '2024-01-01', '08:00:00', '2024-01-01', '10:30:00', 'AC001', 'SGNHAN'),
    ('FL0002', '2024-01-02', '12:45:00', '2024-01-02', '15:15:00', 'AC002', 'HANSGN'),
    ('FL0003', '2024-01-03', '18:30:00', '2024-01-03', '21:00:00', 'AC003', 'HANDAD'),
    ('FL0004', '2024-01-04', '09:15:00', '2024-01-04', '11:45:00', 'AC004', 'DADHAN'),
    ('FL0005', '2024-01-05', '14:00:00', '2024-01-05', '16:30:00', 'AC005', 'SGNDAD'),
    ('FL0006', '2024-01-06', '20:45:00', '2024-01-06', '23:15:00', 'AC006', 'DADSGN'),
    ('FL0007', '2024-01-07', '07:30:00', '2024-01-07', '10:00:00', 'AC007', 'HANSWF'),
    ('FL0008', '2024-01-08', '13:15:00', '2024-01-08', '15:45:00', 'AC008', 'SWFHAN'),
    ('FL0009', '2024-01-09', '19:00:00', '2024-01-09', '21:30:00', 'AC009', 'HANHND'),
    ('FL0010', '2024-01-10', '10:45:00', '2024-01-10', '13:15:00', 'AC010', 'HNDHAN'),
    ('FL0011', '2024-01-11', '16:30:00', '2024-01-11', '19:00:00', 'AC011', 'HANBGH'),
    ('FL0012', '2024-01-12', '05:15:00', '2024-01-12', '07:45:00', 'AC012', 'BGHHAN'),
    ('FL0013', '2024-01-13', '11:00:00', '2024-01-13', '13:30:00', 'AC013', 'HANNAY'),
    ('FL0014', '2024-01-14', '16:45:00', '2024-01-14', '19:15:00', 'AC014', 'NAYHAN'),
    ('FL0015', '2024-01-15', '22:30:00', '2024-01-15', '01:00:00', 'AC015', 'HANPHT'),
    ('FL0016', '2024-01-16', '09:15:00', '2024-01-16', '11:45:00', 'AC016', 'PHTHAN'),
    ('FL0017', '2024-01-17', '15:00:00', '2024-01-17', '17:30:00', 'AC017', 'HANBML'),
    ('FL0018', '2024-01-18', '20:45:00', '2024-01-18', '23:15:00', 'AC018', 'BMLHAN'),
    ('FL0019', '2024-01-19', '06:30:00', '2024-01-19', '09:00:00', 'AC019', 'HANYQY'),
    ('FL0020', '2024-01-20', '12:15:00', '2024-01-20', '14:45:00', 'AC020', 'YQYHAN'),
    ('FL0021', '2024-01-21', '18:00:00', '2024-01-21', '20:30:00', 'AC021', 'HANYHM'),
    ('FL0022', '2024-01-22', '07:45:00', '2024-01-22', '10:15:00', 'AC022', 'YHMHAN'),
    ('FL0023', '2024-01-23', '13:30:00', '2024-01-23', '16:00:00', 'AC023', 'HANDMK'),
    ('FL0024', '2024-01-24', '19:15:00', '2024-01-24', '21:45:00', 'AC024', 'DMKHAN'),
    ('FL0025', '2024-01-25', '08:00:00', '2024-01-25', '10:30:00', 'AC025', 'HANSAW'),
    ('FL0026', '2024-01-26', '13:45:00', '2024-01-26', '16:15:00', 'AC026', 'SAWHAN'),
    ('FL0027', '2024-01-27', '19:30:00', '2024-01-27', '22:00:00', 'AC027', 'HANHLA'),
    ('FL0028', '2024-01-28', '05:15:00', '2024-01-28', '07:45:00', 'AC028', 'HLAHAN'),
    ('FL0029', '2024-01-29', '11:00:00', '2024-01-29', '13:30:00', 'AC029', 'HANTGA'),
    ('FL0030', '2024-01-30', '16:45:00', '2024-01-30', '19:15:00', 'AC030', 'TGAHAN'),
    ('FL0031', '2024-01-31', '22:30:00', '2024-01-31', '01:00:00', 'AC031', 'HANPSK'),
    ('FL0032', '2024-02-01', '09:15:00', '2024-02-01', '11:45:00', 'AC032', 'PSKHAN'),
    ('FL0033', '2024-02-02', '15:00:00', '2024-02-02', '17:30:00', 'AC033', 'HANAZP'),
    ('FL0034', '2024-02-03', '20:45:00', '2024-02-03', '23:15:00', 'AC034', 'AZPHAN'),
    ('FL0035', '2024-02-04', '06:30:00', '2024-02-04', '09:00:00', 'AC035', 'HANDEL'),
    ('FL0036', '2024-02-05', '12:15:00', '2024-02-05', '14:45:00', 'AC036', 'DELHAN'),
    ('FL0037', '2024-02-06', '18:00:00', '2024-02-06', '20:30:00', 'AC037', 'HANZRH'),
    ('FL0038', '2024-02-07', '07:45:00', '2024-02-07', '10:15:00', 'AC038', 'ZRHHAN'),
    ('FL0039', '2024-02-08', '13:30:00', '2024-02-08', '16:00:00', 'AC039', 'HANICN'),
    ('FL0040', '2024-02-09', '19:15:00', '2024-02-09', '21:45:00', 'AC040', 'ICNHAN'),
    ('FL0041', '2024-02-10', '08:00:00', '2024-02-10', '10:30:00', 'AC041', 'HANHKG'),
    ('FL0042', '2024-02-11', '13:45:00', '2024-02-11', '16:15:00', 'AC042', 'HANWHP'),
    ('FL0043', '2024-02-12', '19:30:00', '2024-02-12', '22:00:00', 'AC043', 'WHPHAN'),
    ('FL0044', '2024-02-13', '05:15:00', '2024-02-13', '07:45:00', 'AC044', 'HANKIX'),
    ('FL0045', '2024-02-14', '11:00:00', '2024-02-14', '13:30:00', 'AC045', 'KIXHAN'),
    ('FL0046', '2024-02-15', '16:45:00', '2024-02-15', '19:15:00', 'AC046', 'HANMHT'),
    ('FL0047', '2024-02-16', '22:30:00', '2024-02-16', '01:00:00', 'AC047', 'MHTHAN'),
    ('FL0048', '2024-02-17', '09:15:00', '2024-02-17', '11:45:00', 'AC048', 'HANPVG'),
    ('FL0049', '2024-02-18', '15:00:00', '2024-02-18', '17:30:00', 'AC049', 'PVGHAN'),
    ('FL0050', '2024-02-19', '20:45:00', '2024-02-19', '23:15:00', 'AC050', 'HANCDG'),
    ('FL0051', '2024-02-20', '06:30:00', '2024-02-20', '09:00:00', 'AC051', 'CDGHAN'),
    ('FL0052', '2024-02-21', '12:15:00', '2024-02-21', '14:45:00', 'AC052', 'HANAGB'),
    ('FL0053', '2024-02-22', '18:00:00', '2024-02-22', '20:30:00', 'AC053', 'AGBHAN'),
    ('FL0054', '2024-02-23', '07:45:00', '2024-02-23', '10:15:00', 'AC054', 'HANMLB'),
    ('FL0055', '2024-02-24', '13:30:00', '2024-02-24', '16:00:00', 'AC055', 'MLBHAN'),
    ('FL0056', '2024-02-25', '19:15:00', '2024-02-25', '21:45:00', 'AC056', 'HANCXH'),
    ('FL0057', '2024-02-26', '05:00:00', '2024-02-26', '07:30:00', 'AC057', 'CXHHAN'),
    ('FL0058', '2024-02-27', '10:45:00', '2024-02-27', '13:15:00', 'AC058', 'HANBNE'),
    ('FL0059', '2024-02-28', '16:30:00', '2024-02-28', '19:00:00', 'AC059', 'BNEHAN'),
    ('FL0060', '2024-03-01', '22:15:00', '2024-03-01', '00:45:00', 'AC060', 'HANDEL');

INSERT INTO flight_schedule (flight_code, departure_date, departure_time, arrival_date, arrival_time, aircraft, route)
    VALUES ('FL0061', '2024-01-02', '08:00:00', '2024-01-02', '10:30:00', 'AC001', 'HANSGN'),
    ('FL0062', '2024-01-03', '12:45:00', '2024-01-03', '15:15:00', 'AC002', 'SGNHAN'),
    ('FL0063', '2024-01-04', '18:30:00', '2024-01-04', '21:00:00', 'AC003', 'DADHAN'),
    ('FL0064', '2024-01-05', '09:15:00', '2024-01-05', '11:45:00', 'AC004', 'HANDAD'),
    ('FL0065', '2024-01-06', '14:00:00', '2024-01-06', '16:30:00', 'AC005', 'DADSGN'),
    ('FL0066', '2024-01-07', '20:45:00', '2024-01-07', '23:15:00', 'AC006', 'SGNDAD'),
    ('FL0067', '2024-01-08', '07:30:00', '2024-01-08', '10:00:00', 'AC007', 'SWFHAN'),
    ('FL0068', '2024-01-08', '13:15:00', '2024-01-09', '15:45:00', 'AC008', 'HANSWF'),
    ('FL0069', '2024-01-10', '19:00:00', '2024-01-10', '21:30:00', 'AC009', 'HNDHAN'),
    ('FL0070', '2024-01-11', '10:45:00', '2024-01-11', '13:15:00', 'AC010', 'HANHND'),
    ('FL0071', '2024-01-12', '16:30:00', '2024-01-12', '19:00:00', 'AC011', 'BGHHAN'),
    ('FL0072', '2024-01-13', '05:15:00', '2024-01-13', '07:45:00', 'AC012', 'HANBGH'),
    ('FL0073', '2024-01-14', '11:00:00', '2024-01-14', '13:30:00', 'AC013', 'NAYHAN'),
    ('FL0074', '2024-01-15', '16:45:00', '2024-01-15', '19:15:00', 'AC014', 'HANNAY'),
    ('FL0075', '2024-01-16', '22:30:00', '2024-01-16', '01:00:00', 'AC015', 'PHTHAN'),
    ('FL0076', '2024-01-17', '09:15:00', '2024-01-17', '11:45:00', 'AC016', 'HANPHT'),
    ('FL0077', '2024-01-18', '15:00:00', '2024-01-18', '17:30:00', 'AC017', 'BMLHAN'),
    ('FL0078', '2024-01-19', '20:45:00', '2024-01-19', '23:15:00', 'AC018', 'HANBML'),
    ('FL0079', '2024-01-20', '06:30:00', '2024-01-20', '09:00:00', 'AC019', 'YQYHAN'),
    ('FL0080', '2024-01-21', '12:15:00', '2024-01-21', '14:45:00', 'AC020', 'HANYQY'),
    ('FL0081', '2024-01-22', '18:00:00', '2024-01-22', '20:30:00', 'AC021', 'YHMHAN'),
    ('FL0082', '2024-01-23', '07:45:00', '2024-01-23', '10:15:00', 'AC022', 'HANYHM'),
    ('FL0083', '2024-01-24', '13:30:00', '2024-01-24', '16:00:00', 'AC023', 'DMKHAN'),
    ('FL0084', '2024-01-25', '19:15:00', '2024-01-25', '21:45:00', 'AC024', 'HANDMK'),
    ('FL0085', '2024-01-26', '08:00:00', '2024-01-26', '10:30:00', 'AC025', 'SAWHAN'),
    ('FL0086', '2024-01-27', '13:45:00', '2024-01-27', '16:15:00', 'AC026', 'HANSAW'),
    ('FL0087', '2024-01-28', '19:30:00', '2024-01-28', '22:00:00', 'AC027', 'HLAHAN'),
    ('FL0088', '2024-01-29', '05:15:00', '2024-01-29', '07:45:00', 'AC028', 'HANHLA'),
    ('FL0089', '2024-01-30', '11:00:00', '2024-01-30', '13:30:00', 'AC029', 'TGAHAN'),
    ('FL0090', '2024-01-31', '16:45:00', '2024-01-31', '19:15:00', 'AC030', 'HANTGA'),
    ('FL0091', '2024-02-01', '22:30:00', '2024-02-01', '01:00:00', 'AC031', 'PSKHAN'),
    ('FL0092', '2024-02-02', '09:15:00', '2024-02-02', '11:45:00', 'AC032', 'HANPSK'),
    ('FL0093', '2024-02-03', '15:00:00', '2024-02-03', '17:30:00', 'AC033', 'AZPHAN'),
    ('FL0094', '2024-02-04', '20:45:00', '2024-02-04', '23:15:00', 'AC034', 'HANAZP'),
    ('FL0095', '2024-02-05', '06:30:00', '2024-02-05', '09:00:00', 'AC035', 'DELHAN'),
    ('FL0096', '2024-02-06', '12:15:00', '2024-02-06', '14:45:00', 'AC036', 'HANDEL'),
    ('FL0097', '2024-02-07', '18:00:00', '2024-02-07', '20:30:00', 'AC037', 'ZRHHAN'),
    ('FL0098', '2024-02-08', '07:45:00', '2024-02-08', '10:15:00', 'AC038', 'HANZRH'),
    ('FL0099', '2024-02-08', '13:30:00', '2024-02-09', '16:00:00', 'AC039', 'ICNHAN'),
    ('FL0100', '2024-02-10', '19:15:00', '2024-02-10', '21:45:00', 'AC040', 'HANICN'),
    ('FL0101', '2024-02-11', '08:00:00', '2024-02-11', '10:30:00', 'AC041', 'HKGHAN'),
    ('FL0102', '2024-02-12', '13:45:00', '2024-02-12', '16:15:00', 'AC042', 'WHPHAN'),
    ('FL0103', '2024-02-13', '19:30:00', '2024-02-13', '22:00:00', 'AC043', 'HANWHP'),
    ('FL0104', '2024-02-14', '05:15:00', '2024-02-14', '07:45:00', 'AC044', 'KIXHAN'),
    ('FL0105', '2024-02-15', '11:00:00', '2024-02-15', '13:30:00', 'AC045', 'HANKIX'),
    ('FL0106', '2024-02-16', '16:45:00', '2024-02-16', '19:15:00', 'AC046', 'MHTHAN'),
    ('FL0107', '2024-02-17', '22:30:00', '2024-02-17', '01:00:00', 'AC047', 'HANMHT'),
    ('FL0108', '2024-02-18', '09:15:00', '2024-02-18', '11:45:00', 'AC048', 'PVGHAN'),
    ('FL0109', '2024-02-19', '15:00:00', '2024-02-19', '17:30:00', 'AC049', 'HANPVG'),
    ('FL0110', '2024-02-20', '20:45:00', '2024-02-20', '23:15:00', 'AC050', 'CDGHAN'),
    ('FL0111', '2024-02-21', '06:30:00', '2024-02-21', '09:00:00', 'AC051', 'HANCDG'),
    ('FL0112', '2024-02-22', '12:15:00', '2024-02-22', '14:45:00', 'AC052', 'AGBHAN'),
    ('FL0113', '2024-02-23', '18:00:00', '2024-02-23', '20:30:00', 'AC053', 'HANAGB'),
    ('FL0114', '2024-02-24', '07:45:00', '2024-02-24', '10:15:00', 'AC054', 'MLBHAN'),
    ('FL0115', '2024-02-25', '13:30:00', '2024-02-25', '16:00:00', 'AC055', 'HANMLB'),
    ('FL0116', '2024-02-26', '19:15:00', '2024-02-26', '21:45:00', 'AC056', 'CXHHAN'),
    ('FL0117', '2024-02-27', '05:00:00', '2024-02-27', '07:30:00', 'AC057', 'HANCXH'),
    ('FL0118', '2024-02-28', '10:45:00', '2024-02-28', '13:15:00', 'AC058', 'BNEHAN'),
    ('FL0119', '2024-03-01', '16:30:00', '2024-03-01', '19:00:00', 'AC059', 'HANBNE'),
    ('FL0120', '2024-03-02', '22:15:00', '2024-03-02', '00:45:00', 'AC060', 'DELHAN');
